* Packages

Vim 8 has a native package manager, which loads plugins from the =~/.vim/pack/plugins/start= directory[fn:plugins-dir].
To install a package, clone its repository into =~/.vim/pack/plugins/start=:

#+begin_src shell :eval no
  git clone git@github.com:tpope/vim-commentary.git ~/.vim/pack/plugins/start/vim-commentary
#+end_src

When publishing dotfiles to a repository for reuse, it's convenient to use Git submodules instead of regular checkouts.
This allows for checking the dependencies into version control.
Instead of cloning, add a plugin as a submodule:

#+begin_src shell :eval no
  git submodule add git@github.com:tpope/vim-commentary.git ~/.vim/pack/plugins/start/vim-commentary
#+end_src

Another option for installing plugins is using a plugin manager like [[https://github.com/junegunn/vim-plug][vim-plug]].
Instead of using Git checkouts or submodules, vim-plug handles the installing and updating of plugins.

The plugins themselves are configured through a list of calls to the =Plug= in the =~/.vimrc= file:

#+begin_src vimrc :eval no
  Plug 'tpope/vim-commentary'
#+end_src

This configuration uses the latter in an attempt to contain most of the configuration in a single file.

** Vim-plug

[[https://github.com/junegunn/vim-plug#vim][Vim-plug's documentation]] mentions installing the plugin into the autoload directory directly by running a script that downloads =plug.org= to the =~/.vim/autoload= directory:

#+begin_src shell :eval no
curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
#+end_src

Instead, to have Vim install vim-plug on startup (again, to contain the configuration to a single file), this snippet automatically downloads =plug.vim= from its repository if it doesn't exist yet:

#+caption: =~/.vimrc=
#+begin_src vimrc :tangle .vimrc
  " Download plug.vim if it doesn't exist yet
  if empty(glob('~/.vim/autoload/plug.vim'))
    silent !curl -fLo ~/.vim/autoload/plug.vim --create-dirs
      \ https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
  endif
#+end_src

Normally, plugins are installed when calling =:PlugInstall= from within Vim.
To remove an extra step from the setup, this configuration runs a script on startup that checks for missing packages on startup and install them if needed:

#+caption: =~/.vimrc=
#+begin_src vimrc :tangle .vimrc
" Run PlugInstall if there are missing plugins
autocmd VimEnter * if len(filter(values(g:plugs), '!isdirectory(v:val.dir)'))
  \| PlugInstall --sync | source $MYVIMRC
\| endif
#+end_src

All other plugins are installed through vim-plug.

[fn:plugins-dir]: The name of the =start= directory in =~/.vim/pack/plugins/start= can be anything, but "start" seems to make sense.
